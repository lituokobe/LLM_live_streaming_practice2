[{"bbox": [125, 117, 1296, 497], "category": "Text", "text": "```sql\ncreate database mydb;\nuse mydb;\ncreate table person_info (\nphone_num varchar(255),\nname varchar(255),\ncity varchar(255)\n)ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\ninsert into person_info values (186, \"张三\", \"北京\"), (187, \"李四\", \"上海\"), (188, \"王五\", \"深圳\");\n```"}, {"bbox": [113, 547, 293, 590], "category": "Title", "text": "## 2) 编写代码"}, {"bbox": [136, 631, 320, 673], "category": "Text", "text": "* **Java代码**"}, {"bbox": [125, 728, 1603, 1997], "category": "Text", "text": "```java\npublic class RichFunctionTest {\n    public static void main(String[] args) throws Exception {\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        /**\n         * Socket中的数据格式如下:\n         * 001,186,187,busy,1000,10\n         * 002,187,186,fail,2000,20\n         * 003,186,188,busy,3000,30\n         * 004,188,186,busy,4000,40\n         * 005,188,187,busy,5000,50\n        */\n        DataStreamSource<String> ds = env.socketTextStream(\"node5\", 9999);\n        ds.map(new MyRichMapFunction()).print();\n\n        env.execute();\n    }\n\n    private static class MyRichMapFunction extends RichMapFunction<String, String> {\n        Connection conn = null;\n        PreparedStatement pst = null;\n        ResultSet rst = null;\n\n        // open()方法在map方法之前执行,用于初始化\n        @Override\n        public void open(Configration parameters) throws Exception {\n            conn = DriverManager.getConnection(\"jdbc:mysql://node2:3306/mydb?useSSL=false\", \"root\", \"123456\npst = conn preparestatement(\"select * from person_info where phone_num = ?\");\n        }\n    }\n}\n```"}]