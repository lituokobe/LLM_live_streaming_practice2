[{"bbox": [109, 101, 1569, 299], "category": "Text", "text": "Flink的KafkaSink是将数据写入Kafka消息队列的可靠且高性能的输出组件,在大数据实时处理场景中,经过Flink处理分析后的数据写入到Kafka也是常见的场景,Kafka Sink保证写出到Kafka数据的至少一次(at-least-once)和精确一次(exactly-once)语义,确保数据被准确地写入Kafka,避免重复写入或数据丢失。"}, {"bbox": [109, 335, 1552, 483], "category": "Text", "text": "当然,在实际工作中我们希望Flink程序重启恢复后以exactly-once的方式继续将数据写出到Kafka中,下面我们以exactly-once方式写出到Kafka为例来演示Kafka Sink的使用方式,关于Flink写入Kafka at-least-once和exactly-once的原理,可以参考后续状态章节介绍。"}, {"bbox": [109, 519, 1585, 819], "category": "Text", "text": "在使用exactly-once语义向Kafka中写入数据时,需要调整transaction.timeout.ms参数值,该参数值表示生产者向Kafka写入数据时的事务超时时间,该值在Flink写入Kafka时默认为3600000ms=1小时。但在Kafka broker中producer生产者事务超时最大时间transaction.max.timeout.ms)不允许超过15分钟,所以需要在代码中设置transaction.timeout.ms值在15分钟以下,需要否则会报错: Unexpected error in InitProducerIdResponse; The transaction timeout is larger than the maximum value allowed by the broker (as configured by transaction.max.timeout.ms)"}, {"bbox": [109, 851, 995, 903], "category": "Text", "text": "在编写Java或者Scala代码时,需要在项目中引入如下依赖:"}, {"bbox": [126, 945, 782, 1504], "category": "Text", "text": "```xml\n <!-- Kafka 依赖包 -->\n<dependency>\n  <groupId>org.apache.kafka</groupId>\n  <artifactId>kafka_2.12</artifactId>\n  <version>${kafka.version}</version>\n</dependency>\n\n <!-- Flink Kafka Connector 依赖包 -->\n<dependency>\n  <groupId>org.apache.flink</groupId>\n  <artifactId>flink-connector-kafka</artifactId>\n  <version>${flink.version}</version>\n</dependency>\n```"}, {"bbox": [109, 1548, 1177, 1600], "category": "Text", "text": "## 案例：读取Socket中数据实时统计WordCount, 将结果写出到kafka中。"}, {"bbox": [109, 1632, 533, 1683], "category": "Text", "text": "### 1) 启动Kafka, 并创建topic"}, {"bbox": [126, 1729, 1606, 1817], "category": "Text", "text": "```\n#创建kafka topic\n[root@node1 ~]# kafka-topics.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --create --topic flink\n```"}, {"bbox": [126, 1857, 1606, 1943], "category": "Text", "text": "```\n#查看kafka topic 数据\n[root@node1 ~]# kafka-console-consumer.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --topic flink\n```"}, {"bbox": [109, 1989, 295, 2038], "category": "Text", "text": "### 2) 编写代码"}]