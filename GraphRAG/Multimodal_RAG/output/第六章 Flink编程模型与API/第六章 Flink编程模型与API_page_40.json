[{"bbox": [122, 100, 517, 184], "category": "Text", "text": "//方便看到结果设置并行度为2\nenv.setParallelism(2);"}, {"bbox": [122, 230, 174, 266], "category": "Text", "text": "/*"}, {"bbox": [134, 273, 477, 310], "category": "Text", "text": "* socket 中输入数据如下："}, {"bbox": [134, 316, 520, 354], "category": "Text", "text": "* 001,186,187,busy,1000,10"}, {"bbox": [134, 359, 495, 394], "category": "Text", "text": "* 002,187,186,fail,2000,20"}, {"bbox": [134, 401, 520, 438], "category": "Text", "text": "* 003,186,188,busy,3000,30"}, {"bbox": [134, 443, 520, 480], "category": "Text", "text": "* 004,188,186,busy,4000,40"}, {"bbox": [134, 486, 520, 523], "category": "Text", "text": "* 005,188,187,busy,5000,50"}, {"bbox": [134, 529, 174, 565], "category": "Text", "text": "*/"}, {"bbox": [127, 571, 1099, 609], "category": "Text", "text": "uloader = new DataStreamSource < String > ( \"node5\" , 9999);"}, {"bbox": [122, 654, 375, 692], "category": "Text", "text": "//准备FileSink对象"}, {"bbox": [122, 697, 1310, 1332], "category": "Text", "text": "FileSink < String > fileSink = FileSink .forRowFormat( new Path ( \". / output / java-file-result\" ), new SimpleStringEncoder < String > ( \"UTF-8\" )) //生成新桶目录的检查周期,默认1分钟 .withBucketCheckInterval( 1000) //设置文件滚动策略 .withRollingPolicy( DefaultRollingPolicy .builder() //桶不活跃的间隔时长,默认1分钟 .withInactivityInterval( Duration .ofSeconds(30)) //设置文件多大后生成新的文件,默认128M .withMaxPartSize(MemorySize .ofMebiBytes(1024)) //设置每隔多长时间生成一个新的文件,默认1分钟 .withRolloverInterval( Duration .ofSeconds(10)) .build()).build();"}, {"bbox": [122, 1377, 383, 1460], "category": "Text", "text": "//写出数据到文件\nds.sinkTo(fileSink);"}, {"bbox": [122, 1506, 321, 1544], "category": "Text", "text": "env.execute();"}, {"bbox": [134, 1596, 403, 1641], "category": "Section-header", "text": "• Scala代码实现"}, {"bbox": [122, 1692, 1437, 1818], "category": "Text", "text": "val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment\n//设置并行度为2,方便测试\nenv.setParallelism(2)"}, {"bbox": [122, 1863, 174, 1899], "category": "Text", "text": "/*"}, {"bbox": [134, 1906, 472, 1943], "category": "Text", "text": "* Socket中输入数据如下："}, {"bbox": [134, 1948, 520, 1985], "category": "Text", "text": "* 001,186,187,busy,1000,10"}, {"bbox": [134, 1991, 495, 2027], "category": "Text", "text": "* 002,187,186,fail,2000,20"}, {"bbox": [134, 2033, 520, 2070], "category": "Text", "text": "* 003,186,188,busy,3000,30"}]